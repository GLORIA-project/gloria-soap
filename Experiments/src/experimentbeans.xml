<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

	<import resource="classpath*:wsclientbeans.xml" />
	<import resource="classpath*:parameterbeans.xml" />
	<import resource="classpath*:operationbeans.xml" />
	<import resource="classpath*:featurebeans.xml" />
	<import resource="classpath*:credentialbeans.xml" />
	

	<bean id="dataSource" class="org.springframework.jndi.JndiObjectFactoryBean">
		<property name="jndiName" value="java:comp/env/jdbc/gloriaDB" />
	</bean>
	
	<bean id="sqlExperimentSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">
		<property name="dataSource" ref="dataSource" />
	</bean>

	<bean id="experimentMapper" class="org.mybatis.spring.mapper.MapperFactoryBean">
		<property name="mapperInterface"
			value="eu.gloria.gs.services.experiment.base.data.dbservices.ExperimentDBService" />
		<property name="sqlSessionFactory" ref="sqlExperimentSessionFactory" />
	</bean>

	<bean id="experimentAdapter"
		class="eu.gloria.gs.services.experiment.base.data.ExperimentDBAdapter"
		scope="singleton" lazy-init="true">
		<property name="experimentDBService" ref="experimentMapper"></property>
		<property name="parameterFactory" ref="parameterFactory"></property>
		<property name="operationFactory" ref="operationFactory"></property>
	</bean>

	<bean id="modelFactory"
		class="eu.gloria.gs.services.experiment.base.models.ExperimentModelFactory"
		scope="singleton" lazy-init="true">
		<property name="adapter" ref="experimentAdapter"></property>
		<property name="parameterFactory" ref="parameterFactory"></property>
		<property name="operationFactory" ref="operationFactory"></property>
		<property name="featureFactory" ref="featureFactory"></property>
	</bean>

	<bean id="modelManager"
		class="eu.gloria.gs.services.experiment.base.models.ExperimentModelManager"
		scope="singleton" lazy-init="true">
		<property name="modelFactory" ref="modelFactory"></property>
		<property name="adapter" ref="experimentAdapter"></property>
	</bean>

	<bean id="contextFactory"
		class="eu.gloria.gs.services.experiment.base.contexts.ExperimentContextFactory"
		scope="singleton" lazy-init="true">
		<property name="adapter" ref="experimentAdapter"></property>
	</bean>

	<bean id="contextManager"
		class="eu.gloria.gs.services.experiment.base.contexts.ExperimentContextManager"
		scope="singleton" lazy-init="true">
		<property name="contextFactory" ref="contextFactory">
		</property>
	</bean>

	<bean id="rtBooker"
		class="eu.gloria.gs.services.experiment.reservation.RTBooker" lazy-init="true">
		<property name="RTRepository" ref="rtRepository"></property>
	</bean>

	<bean id="experimentBooker"
		class="eu.gloria.gs.services.experiment.reservation.ExperimentBooker" lazy-init="true">
		<property name="adapter" ref="experimentAdapter"></property>
		<property name="RTBooker" ref="rtBooker"></property>
	</bean>

	<bean id="customModel"
		class="eu.gloria.gs.services.experiment.base.models.CustomExperimentModel" lazy-init="true">
		<property name="adapter" ref="experimentAdapter"></property>
		<property name="parameterFactory" ref="parameterFactory"></property>
	</bean>

	<bean id="parameterFactory"
		class="eu.gloria.gs.services.experiment.base.parameters.ExperimentParameterFactory"
		scope="singleton">
	</bean>

	<bean id="operationFactory"
		class="eu.gloria.gs.services.experiment.base.operations.ExperimentOperationFactory"
		scope="singleton">
	</bean>

	<bean id="featureFactory"
		class="eu.gloria.gs.services.experiment.base.models.ExperimentFeatureFactory"
		scope="singleton">
	</bean>

	<bean id="experimentContextService"
		class="eu.gloria.gs.services.experiment.base.models.ExperimentContextService"
		abstract="true">
		<property name="adapter" ref="experimentAdapter"></property>
		<property name="username" ref="experimentUsername"></property>
		<property name="password" ref="experimentPassword"></property>
		<property name="RTRepository" ref="rtRepository"></property>
		<property name="userRepository" ref="userRepository"></property>
		<property name="CCDTeleoperation" ref="ccdTeleoperation"></property>
		<property name="domeTeleoperation" ref="domeTeleoperation"></property>
		<property name="SCamTeleoperation" ref="scamTeleoperation"></property>
		<property name="mountTeleoperation" ref="mountTeleoperation"></property>
		<property name="focuserTeleoperation" ref="focuserTeleoperation"></property>
		<property name="filterWheelTeleoperation" ref="fwTeleoperation"></property>
		<property name="weatherTeleoperation" ref="weatherTeleoperation"></property>
		<property name="imageRepository" ref="imageRepository"></property>
	</bean>

	<bean id="parameterContextService"
		class="eu.gloria.gs.services.experiment.parameters.ParameterContextService"
		parent="experimentContextService" scope="singleton" lazy-init="true">
	</bean>

	<bean id="operationContextService"
		class="eu.gloria.gs.services.experiment.operations.OperationContextService"
		parent="experimentContextService" scope="singleton" lazy-init="true">
	</bean>

	<bean id="PARAMETER_CONTEXT"
		class="eu.gloria.gs.services.experiment.base.parameters.ParameterContext"
		scope="prototype">
		<property name="adapter" ref="experimentAdapter"></property>
		<property name="contextService" ref="parameterContextService"></property>
	</bean>

	<bean id="OPERATION_CONTEXT"
		class="eu.gloria.gs.services.experiment.base.operations.OperationContext"
		scope="prototype">
		<property name="adapter" ref="experimentAdapter"></property>
		<property name="contextService" ref="operationContextService"></property>
	</bean>

	
</beans>
